<div>Teachable Machine Image Model</div>
<button type="button" onclick="init()">Start</button>
<div id="webcam-container"></div>
<div id="label-container"></div>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
<script type="text/javascript">
	// More API functions here:
	// https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

	// the link to your model provided by Teachable Machine export panel
	const URL = "https://teachablemachine.withgoogle.com/models/S3JSBO-y6/";

	let model, webcam, labelContainer, maxPredictions;

	// Load the image model and setup the webcam
	async function init() {
		const modelURL = URL + "model.json";
		const metadataURL = URL + "metadata.json";

		// load the model and metadata
		// Refer to tmImage.loadFromFiles() in the API to support files from a file picker
		// or files from your local hard drive
		// Note: the pose library adds "tmImage" object to your window (window.tmImage)
		model = await tmImage.load(modelURL, metadataURL);
		maxPredictions = model.getTotalClasses();

		labelContainer = document.getElementById("label-container");
		for (let i = 0; i < maxPredictions; i++) {
			// and class labels
			labelContainer.appendChild(document.createElement("div"));
		}
	}

	// run the webcam image through the image model
	async function predict() {
		const labelContainer = document.getElementById("label-container");
		labelContainer.classList.toggle("hide");
		// predict can take in an image, video or canvas html element
		const image = document.getElementById("face-image");

		// predict can take in an image, video or canvas html element
		const prediction = await model.predict(image, false);
		prediction.sort(
			(a, b) => parseFloat(b.probability) - parseFloat(a.probability)
		);

		let resultMessage;
		switch (prediction[0].className) {
			case "tofu":
				resultMessage = "두부상";
				break;
			case "arab":
				resultMessage = "아랍상";
				break;
			default:
				resultMessage = "알 수 없음";
		}
		$(".result-message").html(resultMessage);

		for (let i = 0; i < maxPredictions; i++) {
			const resultBoxes = document.querySelectorAll(
				"#label-container .result-box"
			);
			resultBoxes[i].querySelector(
				"span"
			).innerText = `${prediction[i].className}`;
			const progressDiv = resultBoxes[i].querySelector(
				".progress .progress-bar"
			);
			progressDiv.setAttribute(
				"style",
				`width: ${prediction[i].probability * 100}%`
			);
			progressDiv.innerText = `${Math.round(
				prediction[i].probability * 100,
				2
			)}%`;
		}
	}
</script>
